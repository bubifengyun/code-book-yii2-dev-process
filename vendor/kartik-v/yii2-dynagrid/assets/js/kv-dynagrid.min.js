/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2017
 * @version   1.4.7
 *
 * JQuery Plugin for yii2-dynagrid.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t,i;t={isEmpty:function(t,i){return null===t||void 0===t||t===[]||""===t||i&&""===e.trim(t)},getFormObjectId:function(e){return e.attr("name").toLowerCase().replace(/-/g,"_")+"_activeform"},cacheActiveForm:function(e){var i=e.closest("form"),n=i.data("yiiActiveForm"),r=t.getFormObjectId(e);t.isEmpty(r)||t.isEmpty(n)||(window[r]=n)},handler:function(e,t,i){var n=".dynagrid",r=t.split(" ").join(n+" ")+n;e&&e.length&&e.off(r).on(r,i)}},i=function(t,i){var n=this;n.$element=e(t),e.each(i,function(e,t){n[e]=t}),n.init(),n.listen()},i.prototype={constructor:i,init:function(){var i=this,n=e("#"+i.modalId),r=e("#"+i.dynaGridId),o=t.getFormObjectId(i.$element),a=i.$element.closest("form");i.$form=a,t.isEmpty(window[o])&&t.cacheActiveForm(i.$element),n.insertAfter(r),i.$visibleEl=a.find(".sortable-visible"),i.$hiddenEl=a.find(".sortable-hidden"),i.$visibleKeys=a.find('input[name="visibleKeys"]'),i.$btnSubmit=n.find(".dynagrid-submit"),i.$btnDelete=n.find(".dynagrid-delete"),i.$btnReset=n.find(".dynagrid-reset"),i.$formContainer=a.parent(),i._setColumnKeys(),i.visibleContent=i.$visibleEl.html(),i.hiddenContent=i.$hiddenEl.html(),i.visibleSortableOptions=window[i.$visibleEl.attr("data-krajee-sortable")],i.hiddenSortableOptions=window[i.$hiddenEl.attr("data-krajee-sortable")]},listen:function(){var i=this;t.handler(i.$btnSubmit,"click",e.proxy(i._submit,i)),t.handler(i.$btnDelete,"click",e.proxy(i._delete,i)),t.handler(i.$btnReset,"click",e.proxy(i._reset,i)),t.handler(i.$form,"keypress",function(e){var t=e.which||e.keyCode||0;13===t&&(e.preventDefault(),i._submit())}),t.handler(i.$form,"afterValidate",function(t,n){e.each(n,function(e,t){return t.length>0?(i.$form.show(),i.$formContainer.find(".dynagrid-submit-message").remove(),!0):void 0})})},_setColumnKeys:function(){var t=this;t.visibleKeys=t.$visibleEl.find("li").map(function(t,i){return e(i).attr("id")}).get().join(",")},_submitForm:function(e){var t=this,i=t.$form,n=t.$formContainer;i.hide(),n.prepend(e),setTimeout(function(){i.submit()},1e3)},_submit:function(){var e=this;e._setColumnKeys(),e.$visibleKeys.val(e.visibleKeys),e._submitForm(e.submitMessage)},_delete:function(){var e,t=this,i=window[t.dialogLib];i.confirm(t.deleteConfirmation,function(i){i&&(e=t.$form.find('input[name="deleteFlag"]'),e&&e.length&&e.val(1),t._submitForm(t.deleteMessage))})},_reset:function(){var e=this;e.$visibleEl.sortable("destroy").html(e.visibleContent),e.$hiddenEl.sortable("destroy").html(e.hiddenContent),e._setColumnKeys(),e.$formContainer.find(".dynagrid-submit-message").remove(),e.$visibleEl.sortable(e.visibleSortableOptions),e.$hiddenEl.sortable(e.hiddenSortableOptions),e.$form.trigger("reset.yiiActiveForm"),setTimeout(function(){e.$form.find("select").trigger("change")},100)},reset:function(){var i=this,n=i.$element.closest("form"),r=t.getFormObjectId(i.$element),o=window[r];t.isEmpty(o)||(n.yiiActiveForm("destroy"),n.yiiActiveForm(o.attributes,o.settings)),n.find("select[data-krajee-select2]").each(function(){var t=e(this),i=window[t.attr("data-krajee-select2")]||{};t.data("select2")&&t.select2("destroy"),e.when(t.select2(i)).done(function(){initS2Loading(t.attr("id"),".select2-container--krajee")})}),n.find("[data-krajee-sortable]").each(function(){var t=e(this);t.data("sortable")&&t.sortable("destroy"),t.sortable(window[t.attr("data-krajee-sortable")])})}},e.fn.dynagrid=function(t){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var r=e(this),o=r.data("dynagrid"),a="object"==typeof t&&t;o||(o=new i(this,e.extend({},e.fn.dynagrid.defaults,a,e(this).data())),r.data("dynagrid",o)),"string"==typeof t&&o[t].apply(o,n)})},e.fn.dynagrid.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"",modalId:"",dynaGridId:"",dialogLib:"krajeeDialog"}}(window.jQuery);