/*!
 * @package   yii2-detail-view
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2017
 * @version   1.7.6
 *
 * Client extension for the yii2-detail-view extension
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2017, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t,n;t=".kvDetailView",n={click:"click"+t,afterValidate:"afterValidate"+t};var i=function(t,n){var i=this;i.$element=e(t),e.each(n,function(e,t){i[e]=t}),i.init()};i.prototype={constructor:i,init:function(){var e=this;e.initElements(),e.listen()},alert:function(e,t){var n,i=this;return n=i.alertMessageSettings[e],t&&n?i.alertTemplate.replace("{content}",t).replace("{class}","alert alert-"+n):""},initAlert:function(){var t=this,i=t.$element.find(".kv-alert-container"),a=n.click;i.find(".alert .close").each(function(){var t=e(this);t.off(a).on(a,function(){setTimeout(function(){i.find(".alert").length||i.hide()},300)})})},destroy:function(){var e=this,t=n.click,i=n.afterValidate;e.$btnSave.off(t),e.$btnUpdate.off(t),e.$btnView.off(t),e.$btnDelete.off(t),e.$element.find(".kv-detail-view").closest("form").off(i),e.$element.find(".kv-alert-container .alert .close").off(t)},listen:function(){var t=this,i=t.$element.find(".kv-alert-container"),a=n.click,o=n.afterValidate,l=t.$element.find(".kv-detail-view");l.closest("form").off(o).on(o,function(e,t){void 0!==t&&l.removeClass("kv-detail-loading")}),t.$btnSave.off(a).on(a,function(){i.hide(),l.removeClass("kv-detail-loading").addClass("kv-detail-loading")}),t.$btnUpdate.off(a).on(a,function(){t.setMode("edit")}),t.$btnView.off(a).on(a,function(){t.setMode("view")}),t.$btnDelete.off(a).on(a,function(n){var i,a=e(this),o=t.deleteConfirm;n.preventDefault(),o&&(i=window[t.dialogLib],"function"!=typeof i.confirm&&confirm(o)?t.execDelete(a):i.confirm(o,function(e){e&&t.execDelete(a)}))}),t.initAlert()},execDelete:function(t){var n=this,i=n.$element,a=i.find(".kv-alert-container"),o=n.deleteParams,l=n.deleteAjaxSettings||{},d=i.find(".kv-detail-view");l=e.extend({type:"post",dataType:"json",data:o,url:t.attr("href"),beforeSend:function(){a.html("").hide(),d.removeClass("kv-detail-loading").addClass("kv-detail-loading")},success:function(t){t.success&&(d.hide(),n.$btnDelete.attr("disabled","disabled"),n.$btnUpdate.attr("disabled","disabled"),n.$btnView.attr("disabled","disabled"),n.$btnSave.attr("disabled","disabled")),e.each(t.messages,function(e,t){a.append(n.alert(e,t))}),a.hide().fadeIn("slow",function(){d.removeClass("kv-detail-loading"),n.initAlert()})},error:function(t,i,o){var l="";n.showErrorStack&&(l=t.responseText?e(t.responseText).text():"",l=l&&l.length?"<pre>"+e.trim(l).replace(/\n\s*\n/g,"\n").replace(/</g,"&lt;")+"</pre>":""),l=n.alert("kv-detail-error",o+l),d.removeClass("kv-detail-loading"),a.html(l).hide().fadeIn("slow"),n.initAlert()}},l),e.ajax(l)},setMode:function(e){var t=this,n=t.fadeDelay;"edit"===e?(t.$attribs.fadeOut(n,function(){t.$formAttribs.fadeIn(n),t.$element.removeClass("kv-view-mode kv-edit-mode").addClass("kv-edit-mode")}),t.$buttons1.fadeOut(n,function(){t.$buttons2.fadeIn(n)})):(t.$formAttribs.fadeOut(n,function(){t.$attribs.fadeIn(n),t.$element.removeClass("kv-view-mode kv-edit-mode").addClass("kv-view-mode")}),t.$buttons2.fadeOut(n,function(){t.$buttons1.fadeIn(n)}))},initElements:function(){var e=this,t=e.$element;e.$btnUpdate=t.find(".kv-btn-update"),e.$btnDelete=t.find(".kv-btn-delete"),e.$btnView=t.find(".kv-btn-view"),e.$btnSave=t.find(".kv-btn-save"),e.$attribs=t.find(".kv-attribute"),e.$formAttribs=t.find(".kv-form-attribute"),e.$buttons1=t.find(".kv-buttons-1"),e.$buttons2=t.find(".kv-buttons-2")}},e.fn.kvDetailView=function(t){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var a=e(this),o=a.data("kvDetailView"),l="object"==typeof t&&t;o||(o=new i(this,e.extend({},e.fn.kvDetailView.defaults,l,e(this).data())),a.data("kvDetailView",o)),"string"==typeof t&&o[t].apply(o,n)})},e.fn.kvDetailView.defaults={mode:"view",fadeDelay:800,alertTemplate:"",alertMessageSettings:{},deleteParams:{},deleteAjaxSettings:{},deleteConfirm:"",showErrorStack:!1,dialogLib:""},e.fn.kvDetailView.Constructor=i}(window.jQuery);